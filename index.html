<!-- ... ก่อนหน้าเหมือนเดิม ... -->

<h1>🌐 Real-Time Sensor Dashboard & Control</h1>
<button id="themeToggle">🌙 Dark Mode</button>

<div class="value-cards">
  <div class="card">
    <div class="label">🌡️ Temperature</div>
    <div class="value" id="tempValue">-- °C</div>
  </div>
  <div class="card">
    <div class="label">💧 Dissolved Oxygen (DO)</div>
    <div class="value" id="doValue">-- mg/L</div>
  </div>
</div>

<!-- ✅ เพิ่ม canvas 2 อัน -->
<canvas id="tempChart" width="800" height="400"></canvas>
<canvas id="doChart" width="800" height="400"></canvas>

<div class="buttons">
  <button onclick="sendCommand('all')">Run All</button>
  <button onclick="sendCommand('wash')">Wash</button>
  <button onclick="sendCommand('wipe')">Wipe</button>
</div>

<div id="statusMsg"></div>

<script>
  const firebaseConfig = {
    databaseURL: "https://amu-web-default-rtdb.asia-southeast1.firebasedatabase.app/"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const tempEl = document.getElementById("tempValue");
  const doEl = document.getElementById("doValue");

  const tempCtx = document.getElementById("tempChart").getContext("2d");
  const doCtx = document.getElementById("doChart").getContext("2d");

  const labels = [];
  const tempData = [];
  const doData = [];

  const tempChart = new Chart(tempCtx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Temperature (°C)',
        data: tempData,
        borderColor: '#ff6384',
        fill: false,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: {
          grid: { color: 'rgba(180, 180, 180, 0.2)' }
        },
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(180, 180, 180, 0.2)' }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: getComputedStyle(document.body).getPropertyValue('--text')
          }
        }
      }
    }
  });

  const doChart = new Chart(doCtx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Dissolved Oxygen (mg/L)',
        data: doData,
        borderColor: '#36a2eb',
        fill: false,
        tension: 0.3
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        x: {
          grid: { color: 'rgba(180, 180, 180, 0.2)' }
        },
        y: {
          beginAtZero: true,
          grid: { color: 'rgba(180, 180, 180, 0.2)' }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: getComputedStyle(document.body).getPropertyValue('--text')
          }
        }
      }
    }
  });

  db.ref("sensor").on("value", (snapshot) => {
    const val = snapshot.val();
    if (!val) return;
    const temperature = val.temperature;
    const doValue = val.do;

    const now = new Date();
    const timeLabel = now.toLocaleTimeString();

    tempEl.textContent = `${temperature} °C`;
    doEl.textContent = `${doValue} mg/L`;

    if (labels.length > 30) {
      labels.shift();
      tempData.shift();
      doData.shift();
    }

    labels.push(timeLabel);
    tempData.push(temperature);
    doData.push(doValue);

    tempChart.update();
    doChart.update();
  });

  function sendCommand(cmd) {
    const status = document.getElementById("statusMsg");
    status.textContent = "Working...";
    db.ref("command").set(cmd).then(() => {
      setTimeout(() => {
        status.textContent = "Completed ✅";
      }, 2000);
    });
  }

  const themeToggle = document.getElementById("themeToggle");
  themeToggle.addEventListener("click", () => {
    document.body.classList.toggle("dark");
    themeToggle.textContent = document.body.classList.contains("dark")
      ? "☀️ Light Mode"
      : "🌙 Dark Mode";

    const textColor = getComputedStyle(document.body).getPropertyValue('--text');
    tempChart.options.plugins.legend.labels.color = textColor;
    doChart.options.plugins.legend.labels.color = textColor;

    tempChart.update();
    doChart.update();
  });
</script>
